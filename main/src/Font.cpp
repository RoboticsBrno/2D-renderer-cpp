#include "Font.hpp"

// Font data with proper widths for each character
const uint8_t Font::FONT_DATA[] = {
    // Numbers (width: 5)
    0x0E, 0x11, 0x13, 0x15, 0x19, 0x11, 0x0E, // '0'
    0x04, 0x0C, 0x04, 0x04, 0x04, 0x04, 0x0E, // '1'
    0x0E, 0x11, 0x01, 0x02, 0x04, 0x08, 0x1F, // '2'
    0x0E, 0x11, 0x01, 0x06, 0x01, 0x11, 0x0E, // '3'
    0x02, 0x06, 0x0A, 0x12, 0x1F, 0x02, 0x02, // '4'
    0x1F, 0x10, 0x1E, 0x01, 0x01, 0x11, 0x0E, // '5'
    0x06, 0x08, 0x10, 0x1E, 0x11, 0x11, 0x0E, // '6'
    0x1F, 0x01, 0x02, 0x04, 0x04, 0x04, 0x04, // '7'
    0x0E, 0x11, 0x11, 0x0E, 0x11, 0x11, 0x0E, // '8'
    0x0E, 0x11, 0x11, 0x0F, 0x01, 0x02, 0x0C, // '9'
    
    // Uppercase Letters (most width: 5, some narrower)
    0x04, 0x0A, 0x11, 0x11, 0x1F, 0x11, 0x11, // 'A' (5)
    0x1E, 0x11, 0x11, 0x1E, 0x11, 0x11, 0x1E, // 'B' (5)
    0x0E, 0x11, 0x10, 0x10, 0x10, 0x11, 0x0E, // 'C' (5)
    0x1E, 0x11, 0x11, 0x11, 0x11, 0x11, 0x1E, // 'D' (5)
    0x1F, 0x10, 0x10, 0x1E, 0x10, 0x10, 0x1F, // 'E' (5)
    0x1F, 0x10, 0x10, 0x1E, 0x10, 0x10, 0x10, // 'F' (5)
    0x0E, 0x11, 0x10, 0x17, 0x11, 0x11, 0x0F, // 'G' (5)
    0x11, 0x11, 0x11, 0x1F, 0x11, 0x11, 0x11, // 'H' (5)
    0x0E, 0x04, 0x04, 0x04, 0x04, 0x04, 0x0E, // 'I' (3)
    0x07, 0x02, 0x02, 0x02, 0x02, 0x12, 0x0C, // 'J' (4)
    0x11, 0x12, 0x14, 0x18, 0x14, 0x12, 0x11, // 'K' (5)
    0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x1F, // 'L' (5)
    0x11, 0x1B, 0x15, 0x15, 0x11, 0x11, 0x11, // 'M' (5)
    0x11, 0x19, 0x19, 0x15, 0x13, 0x13, 0x11, // 'N' (5)
    0x0E, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0E, // 'O' (5)
    0x1E, 0x11, 0x11, 0x1E, 0x10, 0x10, 0x10, // 'P' (5)
    0x0E, 0x11, 0x11, 0x11, 0x15, 0x12, 0x0D, // 'Q' (5)
    0x1E, 0x11, 0x11, 0x1E, 0x14, 0x12, 0x11, // 'R' (5)
    0x0E, 0x11, 0x10, 0x0E, 0x01, 0x11, 0x0E, // 'S' (5)
    0x1F, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, // 'T' (5)
    0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0E, // 'U' (5)
    0x11, 0x11, 0x11, 0x11, 0x11, 0x0A, 0x04, // 'V' (5)
    0x11, 0x11, 0x11, 0x15, 0x15, 0x1B, 0x11, // 'W' (5)
    0x11, 0x11, 0x0A, 0x04, 0x0A, 0x11, 0x11, // 'X' (5)
    0x11, 0x11, 0x0A, 0x04, 0x04, 0x04, 0x04, // 'Y' (5)
    0x1F, 0x01, 0x02, 0x04, 0x08, 0x10, 0x1F, // 'Z' (5)
    
    // Lowercase Letters (variable widths)
    0x00, 0x00, 0x0E, 0x01, 0x0F, 0x11, 0x0F, // 'a' (4)
    0x10, 0x10, 0x16, 0x19, 0x11, 0x11, 0x1E, // 'b' (4)
    0x00, 0x00, 0x0E, 0x10, 0x10, 0x11, 0x0E, // 'c' (4)
    0x01, 0x01, 0x0D, 0x13, 0x11, 0x11, 0x0F, // 'd' (4)
    0x00, 0x00, 0x0E, 0x11, 0x1F, 0x10, 0x0E, // 'e' (4)
    0x06, 0x09, 0x08, 0x1C, 0x08, 0x08, 0x08, // 'f' (3)
    0x00, 0x0F, 0x11, 0x11, 0x0F, 0x01, 0x0E, // 'g' (4)
    0x10, 0x10, 0x16, 0x19, 0x11, 0x11, 0x11, // 'h' (4)
    0x04, 0x00, 0x0C, 0x04, 0x04, 0x04, 0x0E, // 'i' (1)
    0x02, 0x00, 0x06, 0x02, 0x02, 0x12, 0x0C, // 'j' (2)
    0x10, 0x10, 0x12, 0x14, 0x18, 0x14, 0x12, // 'k' (4)
    0x0C, 0x04, 0x04, 0x04, 0x04, 0x04, 0x0E, // 'l' (1)
    0x00, 0x00, 0x1A, 0x15, 0x15, 0x15, 0x15, // 'm' (5)
    0x00, 0x00, 0x16, 0x19, 0x11, 0x11, 0x11, // 'n' (4)
    0x00, 0x00, 0x0E, 0x11, 0x11, 0x11, 0x0E, // 'o' (4)
    0x00, 0x00, 0x1E, 0x11, 0x1E, 0x10, 0x10, // 'p' (4)
    0x00, 0x00, 0x0D, 0x13, 0x0F, 0x01, 0x01, // 'q' (4)
    0x00, 0x00, 0x16, 0x19, 0x10, 0x10, 0x10, // 'r' (4)
    0x00, 0x00, 0x0E, 0x10, 0x0E, 0x01, 0x1E, // 's' (4)
    0x08, 0x08, 0x1C, 0x08, 0x08, 0x09, 0x06, // 't' (3)
    0x00, 0x00, 0x11, 0x11, 0x11, 0x13, 0x0D, // 'u' (4)
    0x00, 0x00, 0x11, 0x11, 0x11, 0x0A, 0x04, // 'v' (5)
    0x00, 0x00, 0x11, 0x11, 0x15, 0x15, 0x0A, // 'w' (5)
    0x00, 0x00, 0x11, 0x0A, 0x04, 0x0A, 0x11, // 'x' (5)
    0x00, 0x00, 0x11, 0x11, 0x0F, 0x01, 0x0E, // 'y' (4)
    0x00, 0x00, 0x1F, 0x02, 0x04, 0x08, 0x1F, // 'z' (4)
    
    /// Basic Symbols
    0x04, 0x04, 0x04, 0x04, 0x04, 0x00, 0x04, // '!' (1)
    0x0A, 0x0A, 0x0A, 0x00, 0x00, 0x00, 0x00, // '"' (3)
    0x00, 0x0A, 0x1F, 0x0A, 0x1F, 0x0A, 0x00, // '#' (5)
    0x04, 0x0F, 0x14, 0x0E, 0x05, 0x1E, 0x04, // '$' (5)
    0x18, 0x19, 0x02, 0x04, 0x08, 0x13, 0x03, // '%' (5)
    0x0C, 0x12, 0x14, 0x08, 0x15, 0x12, 0x0D, // '&' (5)
    0x0C, 0x04, 0x08, 0x00, 0x00, 0x00, 0x00, // '\'' (1)
    0x02, 0x04, 0x08, 0x08, 0x08, 0x04, 0x02, // '(' (3)
    0x08, 0x04, 0x02, 0x02, 0x02, 0x04, 0x08, // ')' (3)
    0x00, 0x04, 0x15, 0x0E, 0x15, 0x04, 0x00, // '*' (5)
    0x00, 0x04, 0x04, 0x1F, 0x04, 0x04, 0x00, // '+' (5)
    0x00, 0x00, 0x00, 0x00, 0x0C, 0x04, 0x08, // ',' (1)
    0x00, 0x00, 0x00, 0x1F, 0x00, 0x00, 0x00, // '-' (5)
    0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0x0C, // '.' (1)
    0x00, 0x01, 0x02, 0x04, 0x08, 0x10, 0x00, // '/' (5)
    0x18, 0x18, 0x00, 0x00, 0x18, 0x18, 0x00, // ':' (1)
    0x18, 0x18, 0x00, 0x00, 0x18, 0x08, 0x10, // ';' (1)
    0x02, 0x04, 0x08, 0x10, 0x08, 0x04, 0x02, // '<' (5)
    0x00, 0x00, 0x1F, 0x00, 0x1F, 0x00, 0x00, // '=' (5)
    0x08, 0x04, 0x02, 0x01, 0x02, 0x04, 0x08, // '>' (5)
    0x0E, 0x11, 0x01, 0x02, 0x04, 0x00, 0x04, // '?' (5)
    0x0E, 0x11, 0x17, 0x15, 0x17, 0x10, 0x0E, // '@' (5)
    0x1F, 0x08, 0x08, 0x08, 0x08, 0x08, 0x1F, // '[' (3)
    0x00, 0x00, 0x10, 0x08, 0x04, 0x02, 0x01, // '\' (5)
    0x1C, 0x04, 0x04, 0x04, 0x04, 0x04, 0x1C, // ']' (3)
    0x04, 0x0A, 0x11, 0x00, 0x00, 0x00, 0x00, // '^' (5)
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, // '_' (5)
    0x08, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, // '`' (2)
    0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, // '|' (1)
    0x00, 0x00, 0x1D, 0x17, 0x00, 0x00, 0x00, // '~' (5)
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // ' ' (space) (3)
};

const Font::Glyph Font::FONT_TABLE[] = {
    // Numbers (width: 5)
    {'0', 5, 7, 0, &FONT_DATA[0]},    {'1', 3, 7, 1, &FONT_DATA[7]},
    {'2', 5, 7, 0, &FONT_DATA[14]},   {'3', 5, 7, 0, &FONT_DATA[21]},
    {'4', 5, 7, 0, &FONT_DATA[28]},   {'5', 5, 7, 0, &FONT_DATA[35]},
    {'6', 5, 7, 0, &FONT_DATA[42]},   {'7', 5, 7, 0, &FONT_DATA[49]},
    {'8', 5, 7, 0, &FONT_DATA[56]},   {'9', 5, 7, 0, &FONT_DATA[63]},
    
    // Uppercase
    {'A', 5, 7, 0, &FONT_DATA[70]},   {'B', 5, 7, 0, &FONT_DATA[77]},
    {'C', 5, 7, 0, &FONT_DATA[84]},   {'D', 5, 7, 0, &FONT_DATA[91]},
    {'E', 5, 7, 0, &FONT_DATA[98]},   {'F', 5, 7, 0, &FONT_DATA[105]},
    {'G', 5, 7, 0, &FONT_DATA[112]},  {'H', 5, 7, 0, &FONT_DATA[119]},
    {'I', 3, 7, 1, &FONT_DATA[126]},  {'J', 4, 7, 0, &FONT_DATA[133]},
    {'K', 5, 7, 0, &FONT_DATA[140]},  {'L', 5, 7, 0, &FONT_DATA[147]},
    {'M', 5, 7, 0, &FONT_DATA[154]},  {'N', 5, 7, 0, &FONT_DATA[161]},
    {'O', 5, 7, 0, &FONT_DATA[168]},  {'P', 5, 7, 0, &FONT_DATA[175]},
    {'Q', 5, 7, 0, &FONT_DATA[182]},  {'R', 5, 7, 0, &FONT_DATA[189]},
    {'S', 5, 7, 0, &FONT_DATA[196]},  {'T', 5, 7, 0, &FONT_DATA[203]},
    {'U', 5, 7, 0, &FONT_DATA[210]},  {'V', 5, 7, 0, &FONT_DATA[217]},
    {'W', 5, 7, 0, &FONT_DATA[224]},  {'X', 5, 7, 0, &FONT_DATA[231]},
    {'Y', 5, 7, 0, &FONT_DATA[238]},  {'Z', 5, 7, 0, &FONT_DATA[245]},
    
    // Lowercase
    {'a', 5, 7, 0, &FONT_DATA[252]},  {'b', 5, 7, 0, &FONT_DATA[259]},
    {'c', 4, 7, 0, &FONT_DATA[266]},  {'d', 5, 7, 0, &FONT_DATA[273]},
    {'e', 5, 7, 0, &FONT_DATA[280]},  {'f', 3, 7, 0, &FONT_DATA[287]},
    {'g', 5, 7, 0, &FONT_DATA[294]},  {'h', 5, 7, 0, &FONT_DATA[301]},
    {'i', 3, 7, 1, &FONT_DATA[308]},  {'j', 2, 7, 2, &FONT_DATA[315]},
    {'k', 4, 7, 0, &FONT_DATA[322]},  {'l', 3, 7, 1, &FONT_DATA[329]},
    {'m', 5, 7, 0, &FONT_DATA[336]},  {'n', 5, 7, 0, &FONT_DATA[343]},
    {'o', 5, 7, 0, &FONT_DATA[350]},  {'p', 5, 7, 0, &FONT_DATA[357]},
    {'q', 5, 7, 0, &FONT_DATA[364]},  {'r', 4, 7, 0, &FONT_DATA[371]},
    {'s', 5, 7, 0, &FONT_DATA[378]},  {'t', 3, 7, 0, &FONT_DATA[385]},
    {'u', 5, 7, 0, &FONT_DATA[392]},  {'v', 5, 7, 0, &FONT_DATA[399]},
    {'w', 5, 7, 0, &FONT_DATA[406]},  {'x', 5, 7, 0, &FONT_DATA[413]},
    {'y', 5, 7, 0, &FONT_DATA[420]},  {'z', 4, 7, 0, &FONT_DATA[427]},
    
    // Symbols
    {'!', 1, 7, 2, &FONT_DATA[434]},  {'"', 3, 7, 1, &FONT_DATA[441]},
    {'#', 5, 7, 0, &FONT_DATA[448]},  {'$', 5, 7, 0, &FONT_DATA[455]},
    {'%', 5, 7, 0, &FONT_DATA[462]},  {'&', 5, 7, 0, &FONT_DATA[469]},
    {'\'', 1, 7, 2, &FONT_DATA[476]}, {'(', 3, 7, 1, &FONT_DATA[483]},
    {')', 3, 7, 1, &FONT_DATA[490]},  {'*', 5, 7, 0, &FONT_DATA[497]},
    {'+', 5, 7, 0, &FONT_DATA[504]},  {',', 1, 7, 2, &FONT_DATA[511]},
    {'-', 5, 7, 0, &FONT_DATA[518]},  {'.', 1, 7, 2, &FONT_DATA[525]},
    {'/', 5, 7, 0, &FONT_DATA[532]},  {':', 2, 7, 0, &FONT_DATA[539]},
    {';', 2, 7, 0, &FONT_DATA[546]},  {'<', 5, 7, 0, &FONT_DATA[553]},
    {'=', 5, 7, 0, &FONT_DATA[560]},  {'>', 5, 7, 0, &FONT_DATA[567]},
    {'?', 5, 7, 0, &FONT_DATA[574]},  {'@', 5, 7, 0, &FONT_DATA[581]},
    {'[', 3, 7, 1, &FONT_DATA[588]},  {'\\', 5, 7, 0, &FONT_DATA[595]},
    {']', 3, 7, 0, &FONT_DATA[602]},  {'^', 5, 7, 0, &FONT_DATA[609]},
    {'_', 5, 7, 0, &FONT_DATA[616]},  {'`', 2, 7, 1, &FONT_DATA[623]},
    {'|', 1, 7, 2, &FONT_DATA[630]},  {'~', 5, 7, 0, &FONT_DATA[637]},
    {' ', 3, 7, 1, &FONT_DATA[644]},
};

const size_t Font::FONT_TABLE_SIZE = sizeof(FONT_TABLE) / sizeof(FONT_TABLE[0]);

const Font::Glyph* Font::getGlyph(char c) const {
    for (size_t i = 0; i < FONT_TABLE_SIZE; i++) {
        if (FONT_TABLE[i].character == c) {
            return &FONT_TABLE[i];
        }
    }
    return nullptr;
}

uint8_t Font::getCharWidth(char c) const {
    const Glyph* glyph = getGlyph(c);
    return glyph ? glyph->width : 4; // Default width for unknown chars
}

uint8_t Font::getCharSpacing(char c) const {
    const Glyph* glyph = getGlyph(c);
    if (!glyph) return 1;
    
    // Add less spacing after narrow characters
    switch(glyph->width) {
        case 1: return 2; // Very narrow chars get more spacing
        case 2: return 2;
        case 3: return 1;
        default: return 1; // Normal spacing for wider chars
    }
}

Font defaultFont;
